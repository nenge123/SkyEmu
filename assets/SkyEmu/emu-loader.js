var USERLANG={};USERLANG["zh-CN"] = {
    "import a sav":"导入存档",
    "import status on slot0":"导入存档到档位0",
    "import a room":"导入游戏",
    "View My Rooms":"查看本地游戏",
    "View FileSystem":"查看虚拟文件系统",
    "Mini Window":"最小化",
    "import a bios":"导入BIOS",
    "unpack":"解压"
};
Nenge.addJS(`body{background-color:#000}.skyemu button{-webkit-appearance:button;cursor:pointer}.skyemu>.container{position:absolute;left:0;right:0;z-index:100;margin:0px;padding:0px;transition:all 0.3s}.skyemu>.container>canvas{position:relative;left:0;right:0;bottom:0;top:0;height:100%;width:100%}.skyemu .menu:not([hidden]){display:flex;flex-direction:row;justify-content:space-between;flex-wrap:nowrap;align-items:center;padding:0px 10px;height:30px;cursor:pointer;transition:all 0.3s;user-select:none;touch-action:none}.skyemu .menu:not([hidden]) *{user-select:none;touch-action:none}.skyemu .menu:not([hidden])>.menubtn,.skyemu .menu:not([hidden])>.downbtn{border:0;width:1.5rem;height:1.5rem;border-color:transparent;background-color:transparent;border-radius:4px}.skyemu .menu:not([hidden])>.menubtn>span,.skyemu .menu:not([hidden])>.downbtn>span{display:block;width:24px;height:24px;background:#fff}.skyemu .menu:not([hidden])>.menubtn:hover,.skyemu .menu:not([hidden])>.downbtn:hover{background:#00c1ed;color:#fff}.skyemu .menu:not([hidden])>.downbtn>span{clip-path:path("M 12 20  L4 13  L6 13  L 10 16  L 11 17 L 11 6  L 13 6  L 13 17  L 14 16  L 18 13  L 20 13 Z");transition:all 0.3s}.skyemu .menu:not([hidden])>.downbtn:hover>span{clip-path:path("M 12 24  L4 13  L6 13  L 10 17  L 11 19 L 11 2  L 13 2  L 13 19  L 14 17  L 18 13  L 20 13 Z")}.skyemu .menu:not([hidden]) .title{flex-grow:1;overflow:hidden;text-align:center;text-overflow:ellipsis;white-space:nowrap;font-size:0.675rem}.skyemu .menu:not([hidden]) .menu-list{position:absolute;bottom:calc(100% + 2px);left:0;background:#000;color:#fff;border:1px solid #726a6a;border-radius:5px;margin:auto;padding:20px;width:min(30%, 150px)}.skyemu .menu:not([hidden]) .menu-list button{display:inline-block;background:linear-gradient(360deg, #0238ff, #00b1f5);color:#fff;border-radius:5px;padding:3px;border:1px solid #0f64ff;outline:none;font-size:0.675rem;text-align:left;margin-bottom:10px;margin-right:10px}.skyemu .menu:not([hidden]) .menu-list li{margin-bottom:2px;position:relative}.skyemu .menu:not([hidden]) .menu-list li>a{word-break:break-all;color:#fff}.skyemu .menu:not([hidden]) .menu-list li>ul{position:fixed;background:#000;border:1px solid #726a6a;border-radius:5px;bottom:30px;width:calc(100% - min(30%, 150px) - 70px);height:75%;display:flex;flex-direction:column;flex-wrap:nowrap;align-items:flex-start;overflow:hidden;overflow-y:auto;padding-left:25px;justify-content:flex-start}.skyemu .menu:not([hidden]) .menu-list li>ul li>p{margin:0px;font-size:0.675rem}.skyemu .menu:not([hidden]) .menu-list li>ul li>p:hover{background-color:#075eff;color:#fff}.skyemu .menu:not([hidden]) .menu-list li:not([class~="active"])>ul{right:-200%;transition:right 0.3s}.skyemu .menu:not([hidden]) .menu-list li.active>ul{right:0;transition:right 0.2s}.skyemu .menu:not([hidden]) .menubtn:not([class~="active"])~.menu-list{left:-100vw}.skyemu.active{display:inline-block}.skyemu.active>.menu{border:1px solid #000;border-radius:5px;color:#fff;background:linear-gradient(0deg, #075eff, #00e2f9)}.skyemu.active>.menu>.menubtn{margin-right:10px}.skyemu.active>.menu>.menubtn>span{clip-path:path("M 6 6 L 18 6 L 18 18 L 6 18 L 6 7 L 7 7 L 7 17 L 17 17 L 17 7 L 6 7 Z")}.skyemu.active>.menu+.container{height:0px;width:0px;top:30px;overflow:hidden}.skyemu:not([class~="active"]){position:fixed;top:0;left:0;right:0;bottom:0}@media screen and (orientation:portrait) and (max-width:800px){.skyemu:not([class~="active"]).webapp{bottom:30px}}.skyemu:not([class~="active"]) .menu{position:absolute;left:0;right:0;bottom:0;color:#fff;z-index:101;background-color:#000;background-image:linear-gradient(0deg, black, #545151)}.skyemu:not([class~="active"]) .menu>.menubtn>span{transition:clip-path 0.8s}.skyemu:not([class~="active"]) .menu>.menubtn:not([class~="active"])>span{clip-path:path("M 2 2  L 22 2  L 22 4  L 2 4 Z  M 2 10  L 22 10  L 22 12  L 2 12 Z  M 2 18  L 22 18  L 22 20  L 2 20 Z")}.skyemu:not([class~="active"]) .menu>.menubtn.active>span{clip-path:path("M 6 6 L 8 6 L 18 18 L 16 18 Z  M 18 6 L 8 18 L 6 18 L 16 6 Z")}.skyemu:not([class~="active"]) .container{width:100%}.skyemu:not([class~="active"])>.menu:not([hidden])+.container{bottom:30px;height:calc(100% - 30px)}.skyemu:not([class~="active"])>.menu[hidden]+.container{top:0;bottom:0;height:100%}`,undefined,1,"skyem");
var Module=new class{arguments=["-v","--menu"];preRun=[];postRun=[];print(t){}printErr(t){}totalDependencies=0;functionmonitorRunDependencies(t){this.totalDependencies=Math.max(this.totalDependencies,t)}constructor(t,e){let a=t.I,n=this;t.DB_NAME="Skyemu",t.LibStore="data-libjs",t.DB_STORE_MAP={rooms:{},userdata:{timestamp:!1},"data-libjs":{}},a.defines(n,{T:t,I:a},1),n.JSpath=t.JSpath.split("/").slice(0,-2).join("/")+"/SkyEmu/",n.version=1,n.runaction=t.runaction,n.getLang=t.getLang,n.db={userdata:t.getStore("userdata"),rooms:t.getStore("rooms"),libjs:t.getStore("data-libjs"),"/offline":t.getStore("userdata")},e?(e.JSpath&&(n.JSpath=e.JSpath),e.innerHTML='<div class="skyemu"><div class="menu"><div class="menubtn"><span class="menu-icon"></span></div><div class="title"></div><div class="downbtn"><span class="menu-icon"></span></div><ul class="menu-list"></ul></div><div class="container"><canvas tabindex="-1"></canvas></div></div>',a.defines(e,{Module:n},1)):a.defines(t,{Module:n},1),n.emuElm=Nttr(t.$(".skyemu",e)),navigator.standalone&&n.emuElm.addClass("webapp"),n.DB=n.db,t.docload((async()=>{await n.runaction("loadCores")}))}$(t){return this.emuElm.$(t)}$$(t){return this.emuElm.$$(t)}Nttr(t){return Nttr(this.$(t))}lang={};exit_path=["/offline/recent_games.txt"];action={async loadCores(){let t=this,e=t.T;t.canvas=t.$("canvas");let a=t.$(".title");"undefined"!=typeof USERLANG?t.lang=USERLANG[e.language]:t.lang=await e.FetchItem({url:t.JSpath+"language/"+e.language+".json?t="+e.time,type:"json",process:t=>{a.innerHTML=`language:${e.language} ${t}`}});let n=await e.FetchItem({url:t.JSpath+"SkyEmu.zip",store:"data-libjs",version:t.version,unpack:!0,process:t=>{a.innerHTML=`Skyemu Core:${t}`},packtext:t.getLang("unpack"),decode:t=>(new TextDecoder).decode(t)}),i="string"==typeof n["SkyEmu.js"]?n["SkyEmu.js"]:(new TextDecoder).decode(n["SkyEmu.js"]);i=t.runaction("replaceJS",[i]),t.wasmBinary=n["SkyEmu.wasm"],this.runaction("BuildMenu"),new Function("Module",i)(t)},replaceJS:t=>t.replace(/Module\["run"\]\s?=\s?run;/,";((m,n)=>{m.FS = FS;m.callMain = callMain;if(!m.HEAP8)m.HEAP8 = HEAP8;m.run=run;})(Module,MEMFS);").replace(/WebAssembly\.instantiate\(binary, info\)/,"WebAssembly.instantiate(binary, info).catch(e=>alert(e.message))").replace(/\s*\w+?\.mkdir\("\/offline"\);/,'return Module.runaction("install_FS");').replace(/\(\)\n?\s*\{\n?\s*var\s?\w+?\s?=\s?document\.getElementById\("fileInput"\);/g,"(){return ;").replace(/\(([\$\d\w\s,]+)\)\n?\s*\{\n?\s*var\s?\w+\s?=\s?document\.getElementById\("fileInput"\);/,'($1){var ret_path = Module.LocalGame||"";if(ret_path){Module.GameName = ret_path;}var sz = lengthBytesUTF8(ret_path) + 1;var string_on_heap = _malloc(sz);stringToUTF8(ret_path, string_on_heap, sz);Module.LocalGame = "";return string_on_heap;').replace(/FS\.syncfs\(function\s?\(err\)\s?\{\}\)/g,";").replace(/document\.createElement\("canvas"\)/g,"Module.canvas").replace(/document\.getElementById\([\w\_]+\)/g,"Module.canvas").replace("maybeCStringToJsString(target);",'maybeCStringToJsString(target);if(target=="#canvas")return Module.canvas;').replace(/(\w+?)\.id\s?=\s?"_sokol_app_input_element";/,'Module.app_input_element = $1;$1.classList.add("_sokol_app_input_element");').replace(/document\.getElementById\("_sokol_app_input_element"\)/g,"if(Module.app_input_element)Module.app_input_element").replace(/document\.body\.append/g,'Module.emuElm.$(".container").append').replace(/var\s?(\w+?)\s?=\s?\w+?\.softFullscreen\s?\?\s?innerWidth\s?:\s?\w+?\.width;/,"var optk = Module.canvas.parentNode.getBoundingClientRect();var $1 = optk.width;").replace(/var\s?(\w+?)\s?=\s?\w+?\.softFullscreen\s?\?\s?innerHeight\s?:\s?\w+?\.height;/,"var $1 = optk.height;"),InitAudioContext(t,e,a,n,i){let s=this,r=s.T;return s._saudio_context?"suspended"===s._saudio_context.state?(s._saudio_context.resume(),0):1:(s._saudio_node=null,s._saudio_context=null,s._saudio_context=new AudioContext({sampleRate:t,latencyHint:"interactive"}),s._saudio_node=s._saudio_context.createScriptProcessor(a,0,e),s._saudio_node.onaudioprocess=function(t){var e=t.outputBuffer.length,a=n(e);if(a)for(var s=t.outputBuffer.numberOfChannels,r=0;r<s;r++)for(var o=t.outputBuffer.getChannelData(r),l=0;l<e;l++)o[l]=i[(a>>2)+(s*l+r)]},s._saudio_node.connect(s._saudio_context.destination),s._saudio_context.resume(),"suspended"===s._saudio_context.state?(r.on(document,"pointerdown",(t=>{s._saudio_context.resume()})),0):1)},DiskReadyOut(){let t=this;if(t.ccall("se_load_settings"),t.$(".title").innerHTML="",t.StartEMU)t.StartEMU();else{let e=localStorage.getItem("skyemu-lastgame");e&&t.db.rooms.data(e).then((a=>{t.runaction("writeRoom",[a,e])}))}},install_FS(){let t=this;t.F.replaceWrite(),t.FS.createPath("/","rooms",!0,!0),t.runaction("addMount",["/offline"]),t.F.mountReady().then((t=>{}))},addMount(t){let e=this.FS;e.analyzePath(t).exists||e.createPath("/",t,!0,!0),e.mount(this.F,{},t)},BuildMenu(){let t=this,e=t.T,a="";a+='<li><a href="inline.html" target="_blank">inline run</a></li><li><a href="https://github.com/skylersaleh/SkyEmu" target="_blank">Github:skylersaleh/skyemu</a></li>',e.I.toArr({importSave:"import a sav",importStatus:"import status on slot0",importRoom:"import a room",showData:"View My Rooms",ShowFS:"View FileSystem",miniWin:"Mini Window",importBios:"import a bios",reloadPage:"refreash"},(e=>{a+=`<li><button type="button" data-act="${e[0]}">${t.getLang(e[1])}</button></li>`}));let n=t.Nttr(".menubtn");t.Nttr(".menu-list").html(a).click((a=>{if(a.target instanceof Element){let n=e.attr(a.target,"data-act");n&&t.runaction(n,[a.target])}})),n.click((a=>{if(this.emuElm.active)return this.emuElm.active=!1;e.stopEvent(a),t.runaction("hideMenu",[!n.active])})),n.on("touchstart",(t=>e.stopEvent(t))),n.on("touchend",(t=>e.stopEvent(t))),t.Nttr(".downbtn").click((a=>{if(!t.FS||!t.GameName)return;let n="/offline/"+t.GameTitle+".sav";if(t.FS.analyzePath(n).exists){let a=t.FS.readFile(n);a&&a instanceof Uint8Array&&e.down(t.GameTitle+".sav",a)}}))},reloadPage(){location.reload()},hideMenu(t){let e=this,a=(e.T,e.Nttr(".menubtn")),n=e.Nttr(".menu-list");a.active=t,n.children.forEach((t=>t.classList.remove("active")))},async showData(t){let e=this,a=e.T,n=t.parentNode;e.runaction("hideMenu",[!1]);let i=a.$("ul",n);i?i.innerHTML=e.getLang("wait..."):(i=a.$ct("ul",e.getLang("wait...")),n.appendChild(i)),e.db.rooms.keys().then((t=>{let e="";t.forEach((t=>{e+=`<li><button data-act="RunRoom" data-key="${t}">${t}</button></li>`})),i.innerHTML=e})),n.classList.add("active")},async ShowFS(t){let e=this,a=e.T,n=t.parentNode;e.runaction("hideMenu",[!1]);let i=a.$("ul",n);i?i.innerHTML=e.getLang("wait..."):(i=a.$ct("ul",e.getLang("wait...")),n.appendChild(i));let s='<li><h3>/offline/</h3></li><li><button type="button" data-act="SeleteFSitem" data-key="/">...</button></li>';s+=e.runaction("PathToHtml",["/offline/","/offline/"]),i.innerHTML=s,n.classList.add("active")},SeleteFSitem(t){let e=this,a=e.T,n=a.attr(t,"data-key");if(e.FS.analyzePath(n).exists){let i=e.FS.stat(n).mode;if(e.FS.isFile(i))a.down(a.F.getname(n),e.FS.readFile(n));else if(e.FS.isDir(i)){let a=n.replace(/\/$/,"").split("/").slice(0,-1).join("/")+"/",i=`<li><h3>${n||"ROOT/"}</h3></li><li><button type="button" data-act="SeleteFSitem" data-key="${a||"/"}">...</button></li>`,s=t.parentNode.parentNode;i+=e.runaction("PathToHtml",[n,a]),s.innerHTML=i}}},PathToHtml(t,e){let a=this.T,n="";return a.I.toArr(this.F.getLocalList(t,!0),(t=>{let a=t[1].dir?"button":"p";n+=`<li><${a} data-act="SeleteFSitem" data-key="${t[0]}">${t[0].replace(e,"")}</${a}><p>${t[1].timestamp.toLocaleString()}</p></li>`})),n},importRoom(){let t=this,e=t.T;t.runaction("hideMenu",[!1]),this.upload((a=>{Array.from(a).forEach((async a=>{let n=new Uint8Array(await a.arrayBuffer()),i=a.name;await t.runaction("writeRoom",[await e.unFile(n),i])}))}))},importSave(){let t=this;t.T;t.GameName&&t.upload((e=>{Array.from(e).forEach((async e=>{t.F.MKFILE("/offline/"+t.GameTitle+".sav",new Uint8Array(await e.arrayBuffer())),t.LocalGame="/rooms/"+t.GameName}))}),1)},importBios(){let t=this;t.T;t.upload((e=>{Array.from(e).forEach((async e=>{t.F.MKFILE("/offline/"+t.GameTitle+".sav",new Uint8Array(await e.arrayBuffer()))}))}),1)},importStatus(){let t=this;t.T;t.GameName&&t.upload((e=>{Array.from(e).forEach((async e=>{t.F.MKFILE("/offline/"+t.GameTitle+".slot0.state.png",new Uint8Array(await e.arrayBuffer()))}))}),1)},async RunRoom(t){let e=this,a=e.T.attr(t,"data-key");localStorage.setItem("skyemu-lastgame",a);let n=await e.db.rooms.data(a);n&&e.runaction("writeRoom",[n,a,!0]),e.runaction("hideMenu",[!1])},miniWin(){this.emuElm.active=!0},writeRoom(t,e,a){let n=this,i=n.T;if(t instanceof Uint8Array)n.F.MKFILE("/rooms/"+e,t),n.LocalGame="/rooms/"+e,a||(localStorage.setItem("skyemu-lastgame",e),n.db.rooms.setData(e,t,{type:"Uint8Array"}));else if(t){let e=!1;i.I.toArr(t,(async t=>{n.F.MKFILE("/rooms/"+t[0],t[1]),/\_\_MACOSX\//.test(t[0])||(/\.(gba|gb|gbc)$/.test(t[0])&&(e||(e=!0,n.LocalGame="/rooms/"+t[0],a||localStorage.setItem("skyemu-lastgame",t[0]))),a||n.db.rooms.setData(t[0],t[1],{type:"Uint8Array"}))}))}}};get GameName(){return this.GameFullName}set GameName(t){t=this.T.F.getname(t),this.GameFullName=t,this.GameTitle=t.replace(/\.(gba|gb|gbc)/i,""),this.$(".title").innerHTML=t}F=new class{constructor(t){this.I||this.__autoSet();let e=this,a=e.T;a.I.defines(this,{Module:t},1),e.speed=a.speed,e.runaction=a.runaction}action={};__autoSet(){let t=Nenge,e=t.I;e.defines(this,{T:t,I:e},1)}replaceWrite(){let t=this;t.MEMFS.stream_ops.write=t.ops_write,t.MEMFS.ops_table&&(t.MEMFS.ops_table.file.stream.write=t.ops_write)}get DB(){return this.Module.db}get FS(){return this.Module.FS}get MEMFS(){return this.Module.FS.filesystems.MEMFS}get HEAP8(){return this.Module.HEAP8}getStore(t){let e=this.T,a=this.DB,n=t.mountpoint||t;return a[n]||(a[n]=e.getStore(n)),a[n]}myMount=[];mount(t){let e=this;e.FS.analyzePath(t.mountpoint).exists||e.FS.createPath("/",t.mountpoint,!0,!0);let a=t.mountpoint.split("/").length,n=e.MEMFS.createNode(a<3?e.FS.root:null,a<3?t.mountpoint.split("/").pop():t.mountpoint.replace(/^\//,""),16895,0);return e.getStore(t)&&(e.__mount||(e.__mount=[]),e.__mount.push(e.syncfs(t,(t=>e.Module.runaction("DiskReadyOut",[t]))))),this.myMount.push(t),n}mountReady(){return Promise.all(this.__mount||[])}async syncMount(){let t=this;t._syncMount||(t._syncMount=!0,await Promise.all(t.myMount.map((async e=>{t.syncfs(e,(t=>{}))}))),t._syncMount=!1)}async syncfs(t,e,a){let n=this,i=e;e=a instanceof Function?a:e;let s,r=n.getStore(t);return s=t.isReady?await n.syncWrite(r,t):await n.writeToFS(r),t.isReady=!0,i?(e instanceof Function&&e(i?s:void 0),s):e&&e()}async writeToFS(t){let e=this;return e.I.toArr(await t.all(!0)).map((t=>e.storeLocalEntry(t[0],t[1]))).join("\n")}async syncWrite(t,e){let a=this,n=a.I,i=e.isReady,s=a.getLocalSet(e),r=await a.getRemoteSet(t),o=(i?s:r).entries||{},l=(i?r:s).entries||{},u=await Promise.all(n.toArr(o).filter((t=>{if(!t[1])return"";let e=t[0],a=l[e];return!a||t[1].timestamp>a.timestamp})).map((t=>t[0])).sort().map((async e=>{if(i){let n=a.loadLocalEntry(e);if(n)return await t.put(e,n),"DB saved:"+e}else{let n=await t.get(e);if(n)return a.storeLocalEntry(e,n)}})));return u.concat(await Promise.all(n.toArr(l).filter((t=>{if(!t[1])return"";let e=o[t[0]];t[0];return!e||t[1].timestamp>e.timestamp})).map((t=>t[0])).sort().map((async e=>{let n="";return i?(await t.remove(e),n="DB remove:"):(a.removeLocalEntry(e),n="FS remove:"),n+entry[0]})))),a.Module.runaction("indexdb-sync",[i,u]),u.join("\n")}loadLocalEntry(t){let e,a,n=this,i=n.FS,s=n.Module;if(!s.exit_path||!s.exit_path.includes(t))return i.analyzePath(t).exists?(a=i.lookupPath(t).node,e=i.stat(t),i.isDir(e.mode)?{timestamp:e.mtime,mode:e.mode}:i.isFile(e.mode)?(a.contents=n.getFileDataAsTypedArray(a),{timestamp:e.mtime,mode:e.mode,contents:a.contents}):"node type not supported"):t+" is exists"}storeLocalEntry(t,e){let a=this,n=a.T,i=a.FS,s=a.Module;if(!s.exit_path||!s.exit_path.includes(t)){if(i.isDir(e.mode))!i.analyzePath(t).exists&&i.createPath("/",t,!0,!0);else if(i.isFile(e.mode)){let a=t&&t.split("/").slice(0,-1).join("/");a&&!i.analyzePath(a).exists&&i.createPath("/",a,!0,!0),i.writeFile(t,e.contents,{canOwn:!0,encoding:"binary"})}else n.Err("node type not supported");return i.chmod(t,e.mode),i.utime(t,e.timestamp,e.timestamp),"FS write:"+t}}removeLocalEntry(t){let e=this.FS;if(e.analyzePath(t).exists){var a=e.stat(t);return e.isDir(a.mode)?e.rmdir(t):e.isFile(a.mode)&&e.unlink(t),"FS unlink:"+t}return t+"is not exists"}async getRemoteSet(t,e){let a={type:"remote",store:t,entries:await t.cursor("timestamp",!0)};return e&&e(a),a}getLocalSet(t,e){let a=this.T;t||a.Err("mount:PATH ERROR");let n={type:"local",entries:this.getLocalList(t.mountpoint)};return e&&e(n),n}getLocalList(t,e){t=t||"/";let a=this,n=a.T,i=a.FS,s={},r=[".",".."].concat("/"==t?["dev","tmp","proc"]:[]),o=t=>!r.includes(t),l=t=>e=>a.join2(t,e),u=a.stat(t)&&i.readdir(t).filter(o).map(l(t));for(u||n.Err("mount:PATH ERROR");u.length;){let t=u.pop(),n=a.stat(t);n&&(s[t]={timestamp:n.mtime},i.isDir(n.mode)&&(e||u.push.apply(u,i.readdir(t).filter(o).map(l(t))),s[t].dir=!0))}return s}stat(t){let e=this.FS,a=e.analyzePath(t);if(a.exists&&a.object.node_ops&&a.object.node_ops.getattr)return e.stat(t)}getFileDataAsTypedArray(t){return t.contents?t.contents.subarray?t.contents.subarray(0,t.usedBytes):new Uint8Array(t.contents):new Uint8Array}join(){var t=Array.prototype.slice.call(arguments,0);return this.normalize(t.join("/"))}join2(t,e){return this.normalize(t+"/"+e)}normalize(t){var e="/"===t.charAt(0),a="/"===t.substring(-1);return(t=this.normalizeArray(t.split("/").filter((t=>!!t)),!e).join("/"))||e||(t="."),t&&a&&(t+="/"),(e?"/":"")+t}normalizeArray(t,e){for(var a=0,n=t.length-1;n>=0;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),a++):a&&(t.splice(n,1),a--)}if(e)for(;a;a--)t.unshift("..");return t}ops_write=(t,e,a,n,i,s)=>{let r=this;if(r.HEAP8&&e.buffer===r.HEAP8.buffer&&(s=!1),!n)return 0;var o=t.node;if(o.timestamp=Date.now(),e.subarray&&(!o.contents||o.contents.subarray)){if(s)return o.contents=e.subarray(a,a+n),o.usedBytes=n,n;if(0===o.usedBytes&&0===i)return r.update(t),o.contents=new Uint8Array(e.subarray(a,a+n)),o.usedBytes=n,n;if(i+n<=o.usedBytes)return o.contents.set(e.subarray(a,a+n),i),n}if(r.MEMFS.expandFileStorage(o,i+n),o.contents.subarray&&e.subarray)o.contents.set(e.subarray(a,a+n),i);else for(var l=0;l<n;l++)o.contents[i+l]=e[a+l];return o.usedBytes=Math.max(o.usedBytes,i+n),n};updatePromise(t){let e=this;return new Promise(((a,n)=>{e.updateList.includes(t.node.mount)||e.updateList.push(t.node.mount);let i=setInterval((()=>{e.updateTime&&i!=e.updateTime&&(clearInterval(i),n("other update")),null==t.fd&&(clearInterval(i),a("ok"))}),e.speed);e.updateTime=i}))}updatePath=[];updateList=[];async updateMount(t){let e=this;if(e.updateList.length){let t=e.updateList.map((async t=>e.syncfs(t,(t=>{}))));e.updateList=[],e.updatePath=[],await Promise.all(t)}}update(t){let e=this;e.getStore(t.node.mount)&&t.path&&null!=t.fd&&!e.updatePath.includes(t.path)&&(e.updatePath.push(t.path),e.updatePromise(t).then((t=>e.updateMount(t))))}MKFILE(t,e,a){let n=this.FS,i=t.split("/");if(i=i.length?i.slice(0,-1).join("/"):"/",!n.analyzePath(i).exists){let t=i.split("/").slice(0,-1).join("/");n.analyzePath(t).exists||n.createPath("/",t,!0,!0),n.createPath("/",i,!0,!0)}"string"==typeof e&&(e=(new TextEncoder).encode(e)),a?(n.analyzePath(t).exists&&n.unlink(t),n.writeFile(t,e,{canOwn:!0,encoding:"binary"})):n.analyzePath(t).exists||n.writeFile(t,e,{canOwn:!0,encoding:"binary"})}}(this);upload(t,e){let a=this.T.$ce("input");a.type="file",e||(a.multiple=!0),a.onchange=e=>{let n=e.target.files;if(n&&n.length>0)return t(n);a.remove()},a.click()}async FetchRoom(t,e){let a=this,n=a.T,i=await n.FetchItem({url:t,store:a.db.rooms,unpack:!0}),s=n.F.getname(t);return localStorage.setItem("skyemu-lastgame",s),a.runaction("writeRoom",[i,s,!0])}}(Nenge,"undefined"!=typeof thisELM?thisELM:void 0);